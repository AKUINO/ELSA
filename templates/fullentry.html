$def with (mail,type, id)	
$var recursive : True
$code :
    allElem = c.findAllFromType(type)
    elem = allElem.elements[id]
    keyID = allElem.keyColumn
    permissionKey = type +'_'

$var lang : $c.connectedUsers.users[mail].cuser.fields['language']
<div class="row active" style="color:#f07e26;background-color:#E5E5E7;margin-top:10px;margin-bottom:10px;padding:15px;
$if 'colorgraph' in elem.fields.keys() :
    border-left-style: solid;border-width: 10px;border-color:$(elem.fields['colorgraph']);	

">
    <div class="col-xs-12 " >
	<div class="col-xs-2 vcenter">
	    <button type="button" class="btn btn-warning btn-md $(type)_$(id)" data-toggle="modal" data-target="#$(type)_$(id)modal"><span class="$c.AllHalflings.elements['info'].getHalfling()"></span></button>
	</div>
	<div class="col-xs-1 vcenter" >
	$if 'active' in elem.fields :
	    $if elem.fields['active'] == '0' or  elem.fields['active'] == 0 :
		<span class="glyphicon glyphicon-remove-circle"> </span>
	    $else:
		<span class="glyphicon glyphicon-ok-circle"> </span>
	</div>	    
	<div class="col-xs-1 vcenter" ><span class="$c.AllHalflings.elements[elem.get_name()].getHalfling()"></span> </div>
	<div class="col-xs-3 vcenter">
	       <div class="row">
		   $elem.fields['acronym'] 
	       </div>
	       <div class="row">
		   <strong>$elem.getName(self.lang)</strong>
	       </div>
	</div>
	$if type in 'cpeu':
	    $code :
		groups = c.get_group(allElem.get_key_group())
	    <div class="col-xs-1 vcenter">
		<span class="$c.AllHalflings.elements[groups.get_name_object()].getHalfling()"></span>
	    </div>
	    $if elem.get_group() != '' :
		<div class="col-xs-2 vcenter">
		       $groups.elements[elem.get_group()].fields['acronym']
		</div>
	    $else :
		<div class="col-xs-2 vcenter">
		    -
		</div>
	$elif type == 'b':
	    $code :
		groups = c.get_group(allElem.get_key_group())
	    <div class="col-xs-3 vcenter">
		<div class="row">
		    <div class="col-xs-1 vcenter">
			<span class="$c.AllHalflings.elements[groups.get_name_object()].getHalfling()"></span>
		    </div>
		    $if elem.get_group() != '' :
			<div class="col-xs-2 vcenter">
			       $groups.elements[elem.get_group()].fields['acronym']
			</div>
		    $else :
			<div class="col-xs-2 vcenter">
			    -
			</div>
		</div>
		<div class="row">
		    <div class="col-xs-1 vcenter">
			<span class="$c.AllHalflings.elements['scale'].getHalfling()"></span>
		    </div>
		    <div class="col-xs-2 vcenter">
			$if elem.fields['m_id'] != '':
			    $(elem.get_residual_quantity()) $(c.AllMeasures.elements[elem.fields['m_id']].fields['unit'])
		    </div>
		</div>
	    </div>
	$else:
	    <div class="col-xs-3 vcenter">
	    </div>
	<div class="col-xs-1 vcenter">
	    <button type="button" class="btn btn-warning btn-md " data-toggle="modal" data-target="#modal_menu_$(type)_$(id)"><span class="$c.AllHalflings.elements['menu'].getHalfling()"></span></button>
	</div>
    </div>
</div>

<div class="modal" id="modal_$(type)_$(id)" style="color:back;">
    <div class="modal-dialog">
    </div>
</div>

<script>
    $$(document).ready(function(){
	$$('.$(type)_$(id)').on("click",function(e){
	    $$('#modal_menu_$(type)_$(id)').modal('hide');
	    $$("#modal_$(type)_$(id)").find(".modal-dialog").load("/modal/$(type)_$(id)");
	    $$("#modal_$(type)_$(id)").modal('show');
	});
    });
</script>


<div class="modal" id="modal_menu_$(type)_$(id)">
    <div class="modal-dialog">
	<div class="modal-content">
            <div class="modal-header row ">
		<div class="col-xs-2" >
		</div>
                <h4 class="modal-title col-xs-6 "> $elem.fields['acronym'] - $elem.getName(self.lang)</h4>
		<div class="col-xs-2" >
		</div>
                <button type="button" class="col-xs-2 btn btn-primary" data-dismiss="modal"><strong><big>&times;</big></strong></button>
            </div>
	<div class="modal-body">
                <div class="container-fluid">
		    $if type == "TODO" :
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2">
				<strong><a href="#" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['alarm'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				Alertes en cours
			    </div>
			</div>
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2">
				<strong><a href="#" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['alarm'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				Alarmes en cours
			    </div>
			</div>
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2">
				<strong><a href="#" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['ToDo'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				Things to Do
			    </div>
			</div>
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2">
				<strong><a href="#" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['recipe'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				Point de controle
			    </div>
			</div>
		    $if type == 'b' :
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2">
				<strong><a href="/find/v/$(type)_$(id)" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['pouring'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				$len(c.AllBatches.elements[id].source) $c.AllMessages.elements['mpouring'].getName(self.lang)
			    </div>
			</div>
		    $if type in 'cpeb' :
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2">
				<strong><a href="/find/d/$(type)_$(id)" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['manualdata'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				$len(c.findAllFromType(type).elements[id].data) $c.AllMessages.elements['mdata'].getName(self.lang)
			    </div>
			</div>
		    $if type in 'ceb' :
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2">
				<strong><a href="/find/t/$(type)_$(id)" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['transfer'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				$len(c.findAllFromType(type).elements[id].position) $c.AllMessages.elements['mtransfer'].getName(self.lang)
			    </div>
			</div>
		    <div class="row" style="margin-top:10px;">
			<div class="col-xs-2">
			    <button type="button" class="btn btn-warning btn-md $(type)_$(id)" data-toggle="modal" data-target="#$(type)_$(id)modal"><span class="$c.AllHalflings.elements['info'].getHalfling()"></span></button>
			</div>
			<div class="col-xs-10">
			    $c.AllMessages.elements['info'].getName(self.lang)
			</div>
		    </div>
		    $if type in 'cpemgugrgf' and type not in 'u':
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2">
				<strong><a href="/find/related/$(type)_$id" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['related'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				Related
			    </div>
			</div>
		    $if type in 'cpesm' :
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2" >
				<strong><a href="/graphic/$(type)_$id" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['graphic'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				Graphics
			    </div>
			</div>
		    $if type in 'cpesm' :
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2" >
				<strong><a href="#" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['alarm'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				Alarmlog
			    </div>
			</div>
		    $if type in 'cpeb' :
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2" >
				<strong><a href="/export/$(type)_$(id)" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['exportdata'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				Export
			    </div>
			</div>
		    $if c.AllBarcodes.get_barcode(elem.get_type(), elem.id) != '' :
			<div class="row" style="margin-top:10px;">
			    <div class="col-xs-2" >
				<strong><a href="/barcode/$(c.AllBarcodes.get_barcode(elem.get_type(), elem.id))" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['barcode'].getHalfling()"></span></a></strong>
			    </div>
			    <div class="col-xs-10">
				Barcode
			    </div>
			</div>			
		    <div class="row" style="margin-top:10px;">
			<div class="col-xs-2" >
			    <strong><a href="/edit/$(type)_$(id)" class="btn btn-warning" role="button"><span class="$c.AllHalflings.elements['edit'].getHalfling()"></span></a></strong>
			</div>
			<div class="col-xs-10">
			    Update
			</div>
		    </div>			
                </div>
            </div>
            <div class="modal-footer row">
		<div class="col-xs-10" >
		</div>
		<button type="button" class="col-xs-2 btn btn-primary" data-dismiss="modal"><strong><big>&times;</big></strong></button>
            </div>
        </div>
    </div>
</div>
