$def with (mail, type, id, graph)
$var lang : $c.connectedUsers.users[mail].cuser.fields['language']
$var recursive : True
$code:
    allobjects = c.findAllFromType(type)
    elem = allobjects.elements[id]
    recipe_id = elem.fields['gr_id']
    recipe = None
    if recipe_id and recipe_id in c.AllGrRecipe.elements.keys():
        recipe = c.AllGrRecipe.elements[recipe_id]
    usage = None
    place = elem.get_actual_position_here(c)
    if place:
	    gr_usage = place.get_group()
	    if gr_usage and gr_usage in c.AllGrUsage.elements.keys():
	        usage = c.AllGrUsage.elements[gr_usage]
$#<p style="background: white;">$graph</p>
<div class="modal-body" style="background: white;">
  <div class="container-fluid">
    <div class="row">
	<div id="modalinfo" class="col-xs-6">
	    $:c.getAllHalfling(allobjects)$elem.fields['acronym'] <strong>$elem.getName(self.lang)</strong>
	</div>
	<div id="modalinfo" class="col-xs-6">
        $if place:
	    <a href="/find/related/$(place.get_type())_$(place.getID())">$:c.getAllHalfling(c.AllPlaces)$place.fields['acronym'] <strong>$place.getName(self.lang)</strong></a></br>
	</div>
    </div>
    <div class="row">
	<div id="modalinfo" class="col-xs-6">
        $if recipe:
	    <a href="/find/related/gr_$recipe.getID()">$:c.getAllHalfling(c.AllGrRecipe)$recipe.fields['acronym'] <strong>$recipe.getName(self.lang)</strong></a>
	</div>
	<div id="modalinfo" class="col-xs-6">
        $if usage:
	    <a href="/find/related/gu_$usage.getID()">$:c.getAllHalfling(c.AllGrUsage)$usage.fields['acronym'] <strong>$usage.getName(self.lang)</strong></a>
	</div>
    </div>

<svg class="row" width="100%" height="800px">
  <g/>
</svg>

  </div>
</div>

<script>
var inputGraph = 'digraph{$:graph}';
//window.alert("Input:"+inputGraph);

// Set up zoom support
var svg = d3.select("svg"),
    inner = d3.select("svg g"),
    zoom = d3.zoom().on("zoom", function() {
      inner.attr("transform", d3.event.transform);
    });
svg.call(zoom);

// Create and configure the renderer
var render = dagreD3.render();

  var g;
function tryDraw() {
    try {
      g = graphlibDot.read(inputGraph);
    } catch (e) {
      window.alert("error reading "+inputGraph);
      throw e;
    }

    // Set margins, if not present
    if (!g.graph().hasOwnProperty("marginx") &&
        !g.graph().hasOwnProperty("marginy")) {
      g.graph().marginx = 20;
      g.graph().marginy = 20;
    }

    g.graph().transition = function(selection) {
      return selection.transition().duration(500);
    };

    // Render the graph into svg g
    d3.select("svg g").call(render, g);
}

tryDraw();
</script>

