$def with (connected,type, status)
$var allowed : $connected.cuser.allowed(c)
$var lang : $connected.cuser.fields['language']
$var completeMenu : $connected.completeMenu
$var pinned : $connected.pinned()
$code :
    all = (type[0] == '*')
    if all:
	type = type[1:]
    if type in 'vtd' :
	type = 'b'	
    allObjects = c.findAll(type)
    keyID = allObjects.keyColumn
    permissionKey = type +'_'
    in_use = allObjects.in_use()
    total = len(in_use)
    keys = allObjects.sort_hierarchy(in_use if all else allObjects.get_top(30,in_use))
$var recursive : False
$var title: $c.getName(allObjects,self.lang)
$var bcTop:$type
$var bcOwner:
$var bcElem:
$var bcOperation:list

<div class="row active">
    <label class="col-sm-12">$len(keys)
	$if len(keys) < total:
	    / $total
	$c.getMessage(allObjects.get_class_acronym(),self.lang) :</label>
</div>
$ count_active = 0
$ count_inactive = 0
$ count_complete = 0
$for ikey in keys:
    $ a = allObjects.get(ikey)
    $ active = a.isActive()
    $ complete = a.isComplete()
    $ ok = status == 'all'
    $if active:
        $if not complete:
            $ count_active += 1
            $ ok = status == ''
        $else:
            $ count_complete += 1
            $ ok = status == 'done'
    $else:
        $ count_inactive += 1
        $ ok = status == 'del'
    $if (status == '' and active and not complete) or status == 'all' or (status == 'del' and not active) or (status=='done' and complete):
	$ key = a.get_type()+"_"+a.getID()
	<script>
	    $$(function(){
		$$("#includedMenu$(key)").load("/fullentry/$(key)");
	    });
	</script>
	<div id="includedMenu$(key)" ></div>    

$if not all and (len(keys) < total):
    <div class="row active" style="background-color:rgb(0, 21, 43);">
	<div class="col-xs-11">
	    <a href="/list/*$(type)" class="vcenter"><big>$c.getMessage('all',self.lang) <strong>$total</strong> $c.getMessage(allObjects.get_class_acronym(),self.lang)s</big></a>
	</div>
    </div> 

<div class="row active" style="background-color:rgb(0, 21, 43);">
    <div class="col-xs-5">
	    $if status == '':
                $if count_complete:
        		<a href="?status=done" class="btn btn-default" >$:c.getHalfling('completed')$count_complete</a>
		$if count_inactive:
                    <a href="?status=del" class="btn btn-default" >$:c.getHalfling('disabled')$count_inactive</a>
	    $elif count_active :
	        <a href="/list/*$(type)" class="btn btn-default" >$:c.getHalfling('active')$count_active</a>
    </div>
    $if (type != 'al') and ( " upd_"+type+" " ) in self.allowed:
      <div class="col-xs-6 vcenter addItem">
	<a href="/create/$(type)" class = "vcenter">$:c.getHalfling('add') $c.getName(allObjects,self.lang)</a>
      </div>
</div>    
